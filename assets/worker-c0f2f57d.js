(function(){"use strict";function C(t,e,r){const n=typeof WorkerGlobalScope<"u",i=async a=>{if(a.taskName===t){let l,u;try{l=await r(a.params)}catch(c){u=c}const p={taskName:t,requestId:a.requestId,...l&&{response:l},...u&&{error:u}};n?e.postMessage(p):e.dispatchEvent(new CustomEvent("ogc-client.response",{detail:p}))}};n?e.addEventListener("message",a=>i(a.data)):e.addEventListener("ogc-client.request",a=>i(a.detail))}/*! @rgrove/parse-xml v4.1.0 | ISC License | Copyright Ryan Grove */var U=Object.defineProperty,dt=Object.getOwnPropertyDescriptor,ft=Object.getOwnPropertyNames,pt=Object.prototype.hasOwnProperty,mt=(t,e)=>{for(var r in e)U(t,r,{get:e[r],enumerable:!0})},gt=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ft(e))!pt.call(t,i)&&i!==r&&U(t,i,{get:()=>e[i],enumerable:!(n=dt(e,i))||n.enumerable});return t},Et=t=>gt(U({},"__esModule",{value:!0}),t),Y={};mt(Y,{XmlCdata:()=>z,XmlComment:()=>Q,XmlDeclaration:()=>Z,XmlDocument:()=>tt,XmlDocumentType:()=>et,XmlElement:()=>L,XmlError:()=>rt,XmlNode:()=>h,XmlProcessingInstruction:()=>j,XmlText:()=>k,parseXml:()=>Gt});var J=Et(Y),T="",St=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,bt=class{constructor(t){if(this.k=this.q(t,!0),this.d=0,this.length=t.length,this.n=this.k!==this.length,this.m=t,this.n){let e=[];for(let r=0,n=0;n<this.k;++n)e[n]=r,r+=t.codePointAt(r)>65535?2:1;this.y=e}}get z(){return this.d>=this.k}q(t,e=this.n){return e?t.replace(St,"_").length:t.length}g(t=1){this.d=Math.min(this.k,this.d+t)}i(t=this.d){var e;return this.n?(e=this.y[t])!=null?e:1/0:t}F(t=1){let e=this.h(t);return this.g(t),e}G(t){if(!t.sticky)throw new Error('`regex` must have a sticky flag ("y")');t.lastIndex=this.i();let e=t.exec(this.m);if(e===null||e.length===0)return T;let r=e[0];return this.g(this.q(r)),r}v(t){let e,r=T;for(;(e=this.h())&&t(e);)r+=e,this.g();return r}Q(t){if(this.b(t))return t;if(this.n){let{length:e}=t,r=this.q(t);if(r!==e&&t===this.h(r))return this.g(r),t}return T}b(t){let{length:e}=t;return this.h(e)===t?(this.g(e),t):T}A(t){let e=this.m.slice(this.i()),r=e.search(t);if(r<=0)return T;let n=e.slice(0,r);return this.g(this.q(n)),n}t(t){let{m:e}=this,r=this.i(),n=e.indexOf(t,r);if(n<=0)return T;let i=e.slice(r,n);return this.g(this.q(i)),i}h(t=1){let{d:e,n:r,m:n}=this;return r?e>=this.k?T:n.slice(this.i(e),this.i(e+t)):n.slice(e,e+t)}o(t=0){this.d=t>=0?Math.min(this.k,t):Math.max(0,this.d+t)}},Pt=/[^"&<]+/y,yt=/[^'&<]+/y,wt=/\r\n|[\n\r\t]/g,xt=/<|&|]]>/,Tt=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function q(t){let e=X(t);return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||e===45||e===46||e===183||e>=768&&e<=879||e>=8255&&e<=8256||V(t,e)}function V(t,e=X(t)){return e>=97&&e<=122||e>=65&&e<=90||e===58||e===95||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function vt(t){return t==="#"||q(t)}function Ot(t){let e=X(t);return e===32||e===9||e===10||e===13}function K(t){return t===9||t===10||t===13||t>=32&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111}function X(t){return t.codePointAt(0)||-1}var H=class{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var t,e;return(e=(t=this.parent)==null?void 0:t.document)!=null?e:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===H.TYPE_ELEMENT}get preserveWhitespace(){var t;return!!((t=this.parent)!=null&&t.preserveWhitespace)}get type(){return""}toJSON(){let t={type:this.type};return this.isRootNode&&(t.isRootNode=!0),this.preserveWhitespace&&(t.preserveWhitespace=!0),this.start!==-1&&(t.start=this.start,t.end=this.end),t}},h=H;h.TYPE_CDATA="cdata",h.TYPE_COMMENT="comment",h.TYPE_DOCUMENT="document",h.TYPE_DOCUMENT_TYPE="doctype",h.TYPE_ELEMENT="element",h.TYPE_PROCESSING_INSTRUCTION="pi",h.TYPE_TEXT="text",h.TYPE_XML_DECLARATION="xmldecl";var k=class extends h{constructor(t=""){super(),this.text=t}get type(){return h.TYPE_TEXT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{text:this.text})}},z=class extends k{get type(){return h.TYPE_CDATA}},Q=class extends h{constructor(t=""){super(),this.content=t}get type(){return h.TYPE_COMMENT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{content:this.content})}},Z=class extends h{constructor(t,e,r){super(),this.version=t,this.encoding=e??null,this.standalone=r??null}get type(){return h.TYPE_XML_DECLARATION}toJSON(){let t=h.prototype.toJSON.call(this);t.version=this.version;for(let e of["encoding","standalone"])this[e]!==null&&(t[e]=this[e]);return t}},L=class extends h{constructor(t,e=Object.create(null),r=[]){super(),this.name=t,this.attributes=e,this.children=r}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let t=this;for(;t instanceof L;){if("xml:space"in t.attributes)return t.attributes["xml:space"]==="preserve";t=t.parent}return!1}get text(){return this.children.map(t=>"text"in t?t.text:"").join("")}get type(){return h.TYPE_ELEMENT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(t=>t.toJSON())})}},tt=class extends h{constructor(t=[]){super(),this.children=t}get document(){return this}get root(){for(let t of this.children)if(t instanceof L)return t;return null}get text(){return this.children.map(t=>"text"in t?t.text:"").join("")}get type(){return h.TYPE_DOCUMENT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{children:this.children.map(t=>t.toJSON())})}},et=class extends h{constructor(t,e,r,n){super(),this.name=t,this.publicId=e??null,this.systemId=r??null,this.internalSubset=n??null}get type(){return h.TYPE_DOCUMENT_TYPE}toJSON(){let t=h.prototype.toJSON.call(this);t.name=this.name;for(let e of["publicId","systemId","internalSubset"])this[e]!==null&&(t[e]=this[e]);return t}},rt=class extends Error{constructor(t,e,r){let n=1,i="",a=1;for(let p=0;p<e;++p){let c=r[p];c===`
`?(n=1,i="",a+=1):(n+=1,i+=c)}let l=r.indexOf(`
`,e);i+=l===-1?r.slice(e):r.slice(e,l);let u=0;i.length>50&&(n<40?i=i.slice(0,50):(u=n-20,i=i.slice(u,n+30))),super(`${t} (line ${a}, column ${n})
  ${i}
`+" ".repeat(n-u+1)+`^
`),this.column=n,this.excerpt=i,this.line=a,this.name="XmlError",this.pos=e}},j=class extends h{constructor(t,e=""){super(),this.name=t,this.content=e}get type(){return h.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{name:this.name,content:this.content})}},D="",Ct=class{constructor(t,e={}){let r=this.document=new tt,n=this.c=new bt(t);if(this.l=r,this.f=e,this.f.includeOffsets&&(r.start=0,r.end=t.length),n.b("\uFEFF"),this.H(),!this.B())throw this.a("Root element is missing or invalid");for(;this.w(););if(!n.z)throw this.a("Extra content at the end of the document")}j(t,e){return t.parent=this.l,this.f.includeOffsets&&(t.start=this.c.i(e),t.end=this.c.i()),this.l.children.push(t),!0}x(t,e){let{children:r}=this.l,{length:n}=r;if(t=I(t),n>0){let i=r[n-1];if((i==null?void 0:i.type)===h.TYPE_TEXT){let a=i;return a.text+=t,this.f.includeOffsets&&(a.end=this.c.i()),!0}}return this.j(new k(t),e)}I(){let t=Object.create(null);for(;this.e();){let e=this.r();if(!e)break;let r=this.u()&&this.J();if(r===!1)throw this.a("Attribute value expected");if(e in t)throw this.a(`Duplicate attribute: ${e}`);if(e==="xml:space"&&r!=="default"&&r!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');t[e]=r}if(this.f.sortAttributes){let e=Object.keys(t).sort(),r=Object.create(null);for(let n=0;n<e.length;++n){let i=e[n];r[i]=t[i]}t=r}return t}J(){let{c:t}=this,e=t.h();if(e!=='"'&&e!=="'")return!1;t.g();let r,n=!1,i=D,a=e==='"'?Pt:yt;t:for(;!t.z;)switch(r=t.G(a),r&&(this.p(r),i+=r.replace(wt," ")),t.h()){case e:n=!0;break t;case"&":i+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");case D:break t}if(!n)throw this.a("Unclosed attribute");return t.g(),i}K(){let{c:t}=this,e=t.d;if(!t.b("<![CDATA["))return!1;let r=t.t("]]>");if(this.p(r),!t.b("]]>"))throw this.a("Unclosed CDATA section");return this.f.preserveCdata?this.j(new z(I(r)),e):this.x(r,e)}L(){let{c:t}=this,e=t.d,r=t.A(xt);if(!r)return!1;if(this.p(r),t.h(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.x(r,e)}D(){let{c:t}=this,e=t.d;if(!t.b("<!--"))return!1;let r=t.t("--");if(this.p(r),!t.b("-->"))throw t.h(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.f.preserveComments?this.j(new Q(I(r)),e):!0}M(){let t=this.c.d,e=this.C();return e?this.x(e,t):!1}N(){let{c:t}=this,e=t.d;if(!t.b("<!DOCTYPE"))return!1;let r=this.e()&&this.r();if(!r)throw this.a("Expected a name");let n,i;if(this.e()){if(t.b("PUBLIC")){if(n=this.e()&&this.O(),n===!1)throw this.a("Expected a public identifier");this.e()}if(n!==void 0||t.b("SYSTEM")){if(this.e(),i=this.s(),i===!1)throw this.a("Expected a system identifier");this.e()}}let a;if(t.b("[")){if(a=t.A(/\][\x20\t\r\n]*>/),!t.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!t.b(">"))throw this.a("Unclosed doctype declaration");return this.f.preserveDocumentType?this.j(new et(r,n,i,a),e):!0}B(){let{c:t}=this,e=t.d;if(!t.b("<"))return!1;let r=this.r();if(!r)return t.o(e),!1;let n=this.I(),i=!!t.b("/>"),a=new L(r,n);if(a.parent=this.l,!i){if(!t.b(">"))throw this.a(`Unclosed start tag for element \`${r}\``);this.l=a;do this.L();while(this.B()||this.M()||this.K()||this.E()||this.D());let l=t.d,u;if(!t.b("</")||!(u=this.r())||u!==r)throw t.o(l),this.a(`Missing end tag for element ${r}`);if(this.e(),!t.b(">"))throw this.a(`Unclosed end tag for element ${r}`);this.l=a.parent}return this.j(a,e)}u(){return this.e(),this.c.b("=")?(this.e(),!0):!1}w(){return this.D()||this.E()||this.e()}r(){return V(this.c.h())?this.c.v(q):D}E(){let{c:t}=this,e=t.d;if(!t.b("<?"))return!1;let r=this.r();if(r){if(r.toLowerCase()==="xml")throw t.o(e),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(t.b("?>"))return this.j(new j(r),e);throw this.a("Whitespace is required after a processing instruction name")}let n=t.t("?>");if(this.p(n),!t.b("?>"))throw this.a("Unterminated processing instruction");return this.j(new j(r,I(n)),e)}H(){let{c:t}=this,e=t.d;for(this.P();this.w(););if(this.N())for(;this.w(););return e<t.d}O(){let t=this.c.d,e=this.s();if(e!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(e))throw this.c.o(t),this.a("Invalid character in public identifier");return e}C(){let{c:t}=this;if(!t.b("&"))return!1;let e=t.v(vt);if(t.F()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let r;if(e[0]==="#"){let n=e[1]==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);if(isNaN(n))throw this.a("Invalid character reference");if(!K(n))throw this.a("Character reference resolves to an invalid character");r=String.fromCodePoint(n)}else if(r=Tt[e],r===void 0){let{ignoreUndefinedEntities:n,resolveUndefinedEntity:i}=this.f,a=`&${e};`;if(i){let l=i(a);if(l!=null){let u=typeof l;if(u!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${u}`);return l}}if(n)return a;throw t.o(-a.length),this.a(`Named entity isn't defined: ${a}`)}return r}s(){let{c:t}=this,e=t.b('"')||t.b("'");if(!e)return!1;let r=t.t(e);if(this.p(r),!t.b(e))throw this.a("Missing end quote");return r}e(){return!!this.c.v(Ot)}P(){let{c:t}=this,e=t.d;if(!t.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let r=!!t.b("version")&&this.u()&&this.s();if(r===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(r))throw this.a("Invalid character in version number");let n,i;if(this.e()&&(n=!!t.b("encoding")&&this.u()&&this.s(),n&&this.e(),i=!!t.b("standalone")&&this.u()&&this.s(),i)){if(i!=="yes"&&i!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}if(!t.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.f.preserveXmlDeclaration?this.j(new Z(r,n||void 0,i||void 0),e):!0}a(t){let{c:e}=this;return new rt(t,e.d,e.m)}p(t){let{length:e}=t;for(let r=0;r<e;++r){let n=t.codePointAt(r);if(!K(n))throw this.c.o(-([...t].length-r)),this.a("Invalid character");n>65535&&(r+=1)}}};function I(t){let e=0;for(;(e=t.indexOf("\r",e))!==-1;)t=t[e+1]===`
`?t.slice(0,e)+t.slice(e+1):t.slice(0,e)+`
`+t.slice(e+1);return t}function Gt(t,e){return new Ct(t,e).document}class Nt extends Error{constructor(e){super(e)}}function Lt(t){let e=null;try{e=J.parseXml(t)}catch(r){throw new Nt(r.message)}return e}function M(t){const e=t.indexOf(":");return e>-1?t.substr(e+1):t}function b(t){return t.children[0]}function F(t){return t.name||""}function d(t,e,r=!1){const n=M(e);function i(a,l){return M(F(l))===n&&a.push(l),r&&Array.isArray(l.children)?[...a,...l.children.reduce(i,[])]:a}return t&&Array.isArray(t.children)?t.children.reduce(i,[]):[]}function s(t,e,r=!1){return d(t,e,r)[0]||null}function G(t){return t&&Array.isArray(t.children)?[...t.children.filter(e=>e instanceof J.XmlElement)]:[]}function o(t){const e=t&&Array.isArray(t.children)?t.children.find(r=>r.type==="text"):null;return e?e.text:""}function g(t,e){return t&&t.attributes[e]||""}class W extends Error{constructor(e,r,n){super(e),this.message=e,this.httpStatus=r,this.isCrossOriginRelated=n}}const nt=["utf-8","utf-16","iso-8859-1"],it="utf-8";function It(t){const e=/charset=([^;]+)/.exec(t);return e?e[1]:null}function Mt(t,e){const r=e?It(e):null,n=r?[r,...nt]:nt;for(const i of n)try{return new TextDecoder(i,{fatal:!0}).decode(t)}catch{}return console.warn(`[ogc-client] XML document encoding could not be determined, falling back to ${it}.`),new TextDecoder(it).decode(t)}const A=new Map;let st={};function Ft(t){st=t}function at(){return st}function At(t,e="GET"){const r=`${e}#${t}`;if(A.has(r))return A.get(r);const n=fetch(t,{...at(),method:e}).catch(i=>i).then(i=>(A.delete(r),i));return A.set(r,n),n.then(i=>{if(i instanceof Error)throw i;return i})}function B(t){return At(t).catch(()=>fetch(t,{...at(),method:"HEAD",mode:"no-cors"}).catch(e=>{throw new W(`Fetching the document failed either due to network errors or unreachable host, error is: ${e.message}`,0,!1)}).then(()=>{throw new W("The document could not be fetched due to CORS limitations",0,!0)})).then(async e=>{if(!e.ok){const i=await e.text();throw new W(`Received an error with code ${e.status}: ${i}`,e.status,!1)}const r=await e.arrayBuffer(),n=e.headers.get("Content-Type");return Mt(r,n)}).then(e=>Lt(e))}function ot(t,e){const r=t.match(/(https?%3A%2F%2F[^/]+)$/);if(r){const u=r[1],p=ot(decodeURIComponent(u),e);return t.replace(u,encodeURIComponent(p))}const n=new URL(t),i=Object.keys(e),a=i.map(u=>u.toLowerCase()),l=[];for(const u of n.searchParams.keys())a.indexOf(u.toLowerCase())>-1&&l.push(u);return l.map(u=>n.searchParams.delete(u)),i.forEach(u=>n.searchParams.set(u,e[u]===!0?"":e[u])),n.toString()}const Bt=["EPSG:4046","EPSG:4075","EPSG:4120","EPSG:4122","EPSG:4124","EPSG:4126","EPSG:4149","EPSG:4151","EPSG:4153","EPSG:4155","EPSG:4157","EPSG:4159","EPSG:4161","EPSG:4163","EPSG:4165","EPSG:4167","EPSG:4169","EPSG:4171","EPSG:4173","EPSG:4175","EPSG:4178","EPSG:4180","EPSG:4182","EPSG:4184","EPSG:4188","EPSG:4190","EPSG:4191","EPSG:4196","EPSG:4198","EPSG:4202","EPSG:4210","EPSG:4211","EPSG:4214","EPSG:4226","EPSG:4229","EPSG:4231","EPSG:4233","EPSG:4236","EPSG:4238","EPSG:4240","EPSG:4242","EPSG:4244","EPSG:4246","EPSG:4248","EPSG:4250","EPSG:4252","EPSG:4255","EPSG:4258","EPSG:4261","EPSG:4264","EPSG:4267","EPSG:4270","EPSG:4273","EPSG:4276","EPSG:4279","EPSG:4281","EPSG:4284","EPSG:4286","EPSG:4288","EPSG:4292","EPSG:4295","EPSG:4297","EPSG:4299","EPSG:4302","EPSG:4324","EPSG:4326"];function Rt(t){return Bt.indexOf($(t))>-1}function $(t){return/^urn:(?:x-)?ogc:def:crs:epsg:/.test(t.toLowerCase())?`EPSG:${/([0-9]+)$/.exec(t)[1]}`:t}function lt(t){return b(t).attributes.version}function _t(t){const e=lt(t),r=s(b(t),"Capability");return d(r,"Layer").map(n=>ct(n,e))}function Ut(t){const e=s(b(t),"Service"),r=d(s(e,"KeywordList"),"Keyword").map(o).filter((n,i,a)=>a.indexOf(n)===i);return{title:o(s(e,"Title")),name:o(s(e,"Name")),abstract:o(s(e,"Abstract")),fees:o(s(e,"Fees")),constraints:o(s(e,"AccessConstraints")),keywords:r}}function ct(t,e,r=[],n=[],i=null,a=null){const l=e==="1.3.0"?"CRS":"SRS",u=d(t,l).map(o),p=u.length>0?u:r,c=d(t,"Style").map(Xt),f=c.length>0?c:n;function m(y){const x=g(y,l);return(Rt(x)&&e==="1.3.0"?["miny","minx","maxy","maxx"]:["minx","miny","maxx","maxy"]).map(Ht=>g(y,Ht))}function S(y){return["westBoundLongitude","southBoundLatitude","eastBoundLongitude","northBoundLatitude"].map(x=>o(s(y,x)))}function v(y){return["minx","miny","maxx","maxy"].map(x=>g(y,x))}const N=s(t,"Attribution"),_=N!==null?kt(N):i,O=e==="1.3.0"?s(t,"EX_GeographicBoundingBox"):s(t,"LatLonBoundingBox"),E={};O&&(E["EPSG:4326"]=e==="1.3.0"?S(O):v(O));let P=d(t,"BoundingBox").reduce((y,x)=>({...y,[g(x,l)]:m(x)}),E);P=Object.keys(P).length>0||a===null?P:a;const w=d(t,"Layer").map(y=>ct(y,e,p,f,_,P));return{name:o(s(t,"Name")),title:o(s(t,"Title")),abstract:o(s(t,"Abstract")),availableCrs:p,styles:f,attribution:_,boundingBoxes:P,...w.length&&{children:w}}}function Xt(t){const e=g(s(s(t,"LegendURL"),"OnlineResource"),"xlink:href");return{name:o(s(t,"Name")),title:o(s(t,"Title")),...e&&{legendUrl:e}}}function kt(t){const e=g(s(s(t,"LogoURL"),"OnlineResource"),"xlink:href"),r=g(s(t,"OnlineResource"),"xlink:href"),n=o(s(t,"Title"));return{...n&&{title:n},...r&&{url:r},...e&&{logoUrl:e}}}function R(t){return b(t).attributes.version}function ut(t){const e=R(t);let r;if(e.startsWith("1.0")){const n=s(s(s(b(t),"Capability"),"Request"),"GetFeature");r=G(s(n,"ResultFormat")).map(F)}else{const n=s(b(t),"OperationsMetadata"),i=d(n,"Operation").find(l=>g(l,"name")==="GetFeature"),a=d(i,"Parameter").find(l=>g(l,"name")==="outputFormat");r=d(a,"Value",!0).map(o)}return r}function jt(t){const e=R(t),r=e.startsWith("1.0")?"Service":"ServiceIdentification",n=e.startsWith("1.0")?"Name":"ServiceType",i=s(b(t),r);let a;return e.startsWith("1.0")?a=o(s(i,"Keywords")).split(",").map(l=>l.trim()):a=d(s(i,"Keywords"),"Keyword").map(o),{title:o(s(i,"Title")),name:o(s(i,n)),abstract:o(s(i,"Abstract")),fees:o(s(i,"Fees")),constraints:o(s(i,"AccessConstraints")),keywords:a,outputFormats:ut(t)}}function Dt(t){const e=R(t),r=ut(t),n=s(b(t),"FeatureTypeList");return d(n,"FeatureType").map(i=>Wt(i,e,r))}function Wt(t,e,r){const n=e.startsWith("2.")?"CRS":"SRS",i=e.startsWith("1.0")?"SRS":`Default${n}`;function a(){const c=s(t,"LatLongBoundingBox");return["minx","miny","maxx","maxy"].map(f=>g(c,f)).map(parseFloat)}function l(){const c=s(t,"WGS84BoundingBox");return["LowerCorner","UpperCorner"].map(f=>s(c,f)).map(f=>o(f).split(" ")).reduce((f,m)=>[...f,...m]).map(parseFloat)}const u=e.startsWith("1.0")?[]:d(t,`Other${n}`).map(o).map($),p=e.startsWith("1.0")?[]:d(s(t,"OutputFormats"),"Format").map(o);return{name:o(s(t,"Name")),title:o(s(t,"Title")),abstract:o(s(t,"Abstract")),defaultCrs:$(o(s(t,i))),otherCrs:u,outputFormats:p.length>0?p:r,latLonBoundingBox:e.startsWith("1.0")?a():l()}}function ht(t){const e=["LowerCorner","UpperCorner"].map(r=>s(t,r)).map(r=>o(r).split(" ")).reduce((r,n)=>[...r,...n]).map(parseFloat);return e.some(Number.isNaN)?null:e}function $t(t){const e=b(t),r=s(e,"ServiceIdentification"),n=d(s(r,"Keywords"),"Keyword").map(o),i=s(e,"OperationsMetadata"),a=d(i,"Operation").find(u=>g(u,"name")=="GetTile"),l=d(a,"Get",!0).reduce((u,p)=>{const c=o(s(p,"Value",!0)),f=g(p,"xlink:href");return c.toLowerCase()==="restful"?{...u,rest:f}:{...u,kvp:f}},{});return{title:o(s(r,"Title")),name:o(s(r,"ServiceType")),abstract:o(s(r,"Abstract")),fees:o(s(r,"Fees")),constraints:o(s(r,"AccessConstraints")),keywords:n,getTileUrls:l}}function Yt(t){function e(i){const a=o(s(i,"TopLeftCorner")).split(" ").map(parseFloat);return{identifier:o(s(i,"Identifier")),tileWidth:parseInt(o(s(i,"TileWidth"))),tileHeight:parseInt(o(s(i,"TileHeight"))),matrixWidth:parseInt(o(s(i,"MatrixWidth"))),matrixHeight:parseInt(o(s(i,"MatrixHeight"))),scaleDenominator:parseFloat(o(s(i,"ScaleDenominator"))),topLeft:a}}const r=s(b(t),"Contents");return d(r,"TileMatrixSet").map(i=>{const a=o(s(i,"WellKnownScaleSet")),l=ht(s(i,"BoundingBox"));return{identifier:o(s(i,"Identifier")),crs:o(s(i,"SupportedCRS")),tileMatrices:d(i,"TileMatrix").map(e),...l&&{boundingBox:l},...a&&{wellKnownScaleSet:a}}})}function Jt(t){const e=b(t),r=s(e,"Contents");function n(c){const f=d(r,"TileMatrixSet").find(m=>o(s(m,"Identifier")));return{identifier:o(s(c,"TileMatrixSet")),crs:o(s(f,"SupportedCRS")),limits:d(c,"TileMatrixLimits",!0).map(m=>({tileMatrix:o(s(m,"TileMatrix")),minTileRow:parseInt(o(s(m,"MinTileRow"))),minTileCol:parseInt(o(s(m,"MinTileCol"))),maxTileRow:parseInt(o(s(m,"MaxTileRow"))),maxTileCol:parseInt(o(s(m,"MaxTileCol")))}))}}const i=d(s(e,"OperationsMetadata"),"Operation").find(c=>g(c,"name")=="GetTile"),a=d(i,"Get",!0).filter(c=>o(s(c,"Value",!0)).toLowerCase()==="kvp")[0],l=a?g(a,"xlink:href"):"",u=s(e,"Contents");return d(u,"Layer").map(c=>{const f=ht(s(c,"WGS84BoundingBox"));let m="";const S=d(c,"Style").map(E=>{const P=g(s(E,"LegendURL"),"xlink:href"),w={title:o(s(E,"Title")),name:o(s(E,"Identifier")),...P&&{legendUrl:P}};return g(E,"isDefault")==="true"&&(m=w.name),w}),v=d(c,"Format").map(o),N=d(c,"ResourceURL").filter(E=>g(E,"resourceType")==="tile").map(E=>{const P=g(E,"format"),w=g(E,"template");return{format:P,url:w,encoding:"REST"}});l&&N.push(...v.map(E=>({encoding:"KVP",url:l,format:E})));const _=d(c,"TileMatrixSetLink").map(n),O=d(c,"Dimension").map(E=>{const P=o(s(E,"Identifier")),w=o(s(E,"Default")),y=d(E,"Values").map(o);return{identifier:P,defaultValue:w,values:y}});return{name:o(s(c,"Identifier")),title:o(s(c,"Title")),abstract:o(s(c,"Abstract")),styles:S,resourceUrls:N,matrixSets:_,defaultStyle:m,...f&&{latLonBoundingBox:f},...O&&{dimensions:O}}})}function qt(t,e,r){const n=b(t);let i;if(r.startsWith("2.0"))i=d(n,"member").map(c=>G(c)[0]);else{const c=s(n,"featureMembers");i=c?G(c):d(n,"featureMember").map(f=>G(f)[0])}const a=r==="1.0.0"?"fid":"gml:id";function l(c){return c in e.properties}function u(c,f){switch(e.properties[c]){case"integer":return parseInt(f);case"float":return parseFloat(f);case"boolean":return f==="true";default:return f}}function p(c){return G(c).filter(f=>l(M(F(f)))).reduce((f,m)=>{const S=M(F(m));return{...f,[S]:u(S,o(m))}},{})}return i.map(c=>({id:g(c,a),properties:p(c)}))}function Vt(t){return t.reduce((e,r)=>{for(const n in r.properties){const i=r.properties[n];n in e||(e[n]={uniqueValues:[]});const a=e[n].uniqueValues.find(l=>l.value===i);a?a.count++:e[n].uniqueValues.push({value:i,count:1})}return e},{})}function Kt(t,e,r,n,i,a,l,u,p,c){const f=e==="2.0.0"?"TYPENAMES":"TYPENAME",m=e==="2.0.0"?"COUNT":"MAXFEATURES",S={SERVICE:"WFS",REQUEST:"GetFeature",VERSION:e,[f]:r};if(n!==void 0&&(S.OUTPUTFORMAT=n),a!==void 0&&(S.PROPERTYNAME=a.join(",")),l?(S.RESULTTYPE="hits",S[m]="1"):i!==void 0&&(S[m]=i.toString(10)),u&&(S.SRSNAME=u),p){const v=p.join(",");S.BBOX=c?`${v},${c}`:v}return ot(t,S)}C("parseWmsCapabilities",globalThis,({url:t})=>B(t).then(e=>({info:Ut(e),layers:_t(e),version:lt(e)}))),C("parseWfsCapabilities",globalThis,({url:t})=>B(t).then(e=>({info:jt(e),featureTypes:Dt(e),version:R(e)}))),C("queryWfsFeatureTypeDetails",globalThis,({url:t,serviceVersion:e,featureTypeFull:r})=>{const n=Kt(t,e,r.name,void 0,void 0,Object.keys(r.properties));return B(n).then(i=>({props:Vt(qt(i,r,e))}))}),C("updateFetchOptions",globalThis,({options:t})=>(Ft(t),Promise.resolve({}))),C("parseWmtsCapabilities",globalThis,({url:t})=>B(t).then(e=>({info:$t(e),layers:Jt(e),matrixSets:Yt(e)})))})();
