(function(){"use strict";function x(t,e,r){const n=typeof WorkerGlobalScope<"u",s=async i=>{if(i.taskName===t){let o,l;try{o=await r(i.params)}catch(u){l=u}const f={taskName:t,requestId:i.requestId,...o&&{response:o},...l&&{error:l}};n?e.postMessage(f):e.dispatchEvent(new CustomEvent("ogc-client.response",{detail:f}))}};n?e.addEventListener("message",i=>s(i.data)):e.addEventListener("ogc-client.request",i=>s(i.detail))}/*! @rgrove/parse-xml v4.1.0 | ISC License | Copyright Ryan Grove */var I=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,dt=Object.getOwnPropertyNames,ft=Object.prototype.hasOwnProperty,mt=(t,e)=>{for(var r in e)I(t,r,{get:e[r],enumerable:!0})},pt=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of dt(e))!ft.call(t,s)&&s!==r&&I(t,s,{get:()=>e[s],enumerable:!(n=ut(e,s))||n.enumerable});return t},Et=t=>pt(I({},"__esModule",{value:!0}),t),k={};mt(k,{XmlCdata:()=>q,XmlComment:()=>V,XmlDeclaration:()=>K,XmlDocument:()=>z,XmlDocumentType:()=>H,XmlElement:()=>O,XmlError:()=>Q,XmlNode:()=>h,XmlProcessingInstruction:()=>X,XmlText:()=>_,parseXml:()=>Tt});var D=Et(k),y="",gt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Pt=class{constructor(t){if(this.k=this.q(t,!0),this.d=0,this.length=t.length,this.n=this.k!==this.length,this.m=t,this.n){let e=[];for(let r=0,n=0;n<this.k;++n)e[n]=r,r+=t.codePointAt(r)>65535?2:1;this.y=e}}get z(){return this.d>=this.k}q(t,e=this.n){return e?t.replace(gt,"_").length:t.length}g(t=1){this.d=Math.min(this.k,this.d+t)}i(t=this.d){var e;return this.n?(e=this.y[t])!=null?e:1/0:t}F(t=1){let e=this.h(t);return this.g(t),e}G(t){if(!t.sticky)throw new Error('`regex` must have a sticky flag ("y")');t.lastIndex=this.i();let e=t.exec(this.m);if(e===null||e.length===0)return y;let r=e[0];return this.g(this.q(r)),r}v(t){let e,r=y;for(;(e=this.h())&&t(e);)r+=e,this.g();return r}Q(t){if(this.b(t))return t;if(this.n){let{length:e}=t,r=this.q(t);if(r!==e&&t===this.h(r))return this.g(r),t}return y}b(t){let{length:e}=t;return this.h(e)===t?(this.g(e),t):y}A(t){let e=this.m.slice(this.i()),r=e.search(t);if(r<=0)return y;let n=e.slice(0,r);return this.g(this.q(n)),n}t(t){let{m:e}=this,r=this.i(),n=e.indexOf(t,r);if(n<=0)return y;let s=e.slice(r,n);return this.g(this.q(s)),s}h(t=1){let{d:e,n:r,m:n}=this;return r?e>=this.k?y:n.slice(this.i(e),this.i(e+t)):n.slice(e,e+t)}o(t=0){this.d=t>=0?Math.min(this.k,t):Math.max(0,this.d+t)}},St=/[^"&<]+/y,bt=/[^'&<]+/y,yt=/\r\n|[\n\r\t]/g,wt=/<|&|]]>/,vt=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function $(t){let e=A(t);return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||e===45||e===46||e===183||e>=768&&e<=879||e>=8255&&e<=8256||Y(t,e)}function Y(t,e=A(t)){return e>=97&&e<=122||e>=65&&e<=90||e===58||e===95||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function xt(t){return t==="#"||$(t)}function Ot(t){let e=A(t);return e===32||e===9||e===10||e===13}function W(t){return t===9||t===10||t===13||t>=32&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111}function A(t){return t.codePointAt(0)||-1}var J=class{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var t,e;return(e=(t=this.parent)==null?void 0:t.document)!=null?e:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===J.TYPE_ELEMENT}get preserveWhitespace(){var t;return!!((t=this.parent)!=null&&t.preserveWhitespace)}get type(){return""}toJSON(){let t={type:this.type};return this.isRootNode&&(t.isRootNode=!0),this.preserveWhitespace&&(t.preserveWhitespace=!0),this.start!==-1&&(t.start=this.start,t.end=this.end),t}},h=J;h.TYPE_CDATA="cdata",h.TYPE_COMMENT="comment",h.TYPE_DOCUMENT="document",h.TYPE_DOCUMENT_TYPE="doctype",h.TYPE_ELEMENT="element",h.TYPE_PROCESSING_INSTRUCTION="pi",h.TYPE_TEXT="text",h.TYPE_XML_DECLARATION="xmldecl";var _=class extends h{constructor(t=""){super(),this.text=t}get type(){return h.TYPE_TEXT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{text:this.text})}},q=class extends _{get type(){return h.TYPE_CDATA}},V=class extends h{constructor(t=""){super(),this.content=t}get type(){return h.TYPE_COMMENT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{content:this.content})}},K=class extends h{constructor(t,e,r){super(),this.version=t,this.encoding=e??null,this.standalone=r??null}get type(){return h.TYPE_XML_DECLARATION}toJSON(){let t=h.prototype.toJSON.call(this);t.version=this.version;for(let e of["encoding","standalone"])this[e]!==null&&(t[e]=this[e]);return t}},O=class extends h{constructor(t,e=Object.create(null),r=[]){super(),this.name=t,this.attributes=e,this.children=r}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let t=this;for(;t instanceof O;){if("xml:space"in t.attributes)return t.attributes["xml:space"]==="preserve";t=t.parent}return!1}get text(){return this.children.map(t=>"text"in t?t.text:"").join("")}get type(){return h.TYPE_ELEMENT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(t=>t.toJSON())})}},z=class extends h{constructor(t=[]){super(),this.children=t}get document(){return this}get root(){for(let t of this.children)if(t instanceof O)return t;return null}get text(){return this.children.map(t=>"text"in t?t.text:"").join("")}get type(){return h.TYPE_DOCUMENT}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{children:this.children.map(t=>t.toJSON())})}},H=class extends h{constructor(t,e,r,n){super(),this.name=t,this.publicId=e??null,this.systemId=r??null,this.internalSubset=n??null}get type(){return h.TYPE_DOCUMENT_TYPE}toJSON(){let t=h.prototype.toJSON.call(this);t.name=this.name;for(let e of["publicId","systemId","internalSubset"])this[e]!==null&&(t[e]=this[e]);return t}},Q=class extends Error{constructor(t,e,r){let n=1,s="",i=1;for(let f=0;f<e;++f){let u=r[f];u===`
`?(n=1,s="",i+=1):(n+=1,s+=u)}let o=r.indexOf(`
`,e);s+=o===-1?r.slice(e):r.slice(e,o);let l=0;s.length>50&&(n<40?s=s.slice(0,50):(l=n-20,s=s.slice(l,n+30))),super(`${t} (line ${i}, column ${n})
  ${s}
`+" ".repeat(n-l+1)+`^
`),this.column=n,this.excerpt=s,this.line=i,this.name="XmlError",this.pos=e}},X=class extends h{constructor(t,e=""){super(),this.name=t,this.content=e}get type(){return h.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(h.prototype.toJSON.call(this),{name:this.name,content:this.content})}},B="",Gt=class{constructor(t,e={}){let r=this.document=new z,n=this.c=new Pt(t);if(this.l=r,this.f=e,this.f.includeOffsets&&(r.start=0,r.end=t.length),n.b("\uFEFF"),this.H(),!this.B())throw this.a("Root element is missing or invalid");for(;this.w(););if(!n.z)throw this.a("Extra content at the end of the document")}j(t,e){return t.parent=this.l,this.f.includeOffsets&&(t.start=this.c.i(e),t.end=this.c.i()),this.l.children.push(t),!0}x(t,e){let{children:r}=this.l,{length:n}=r;if(t=G(t),n>0){let s=r[n-1];if((s==null?void 0:s.type)===h.TYPE_TEXT){let i=s;return i.text+=t,this.f.includeOffsets&&(i.end=this.c.i()),!0}}return this.j(new _(t),e)}I(){let t=Object.create(null);for(;this.e();){let e=this.r();if(!e)break;let r=this.u()&&this.J();if(r===!1)throw this.a("Attribute value expected");if(e in t)throw this.a(`Duplicate attribute: ${e}`);if(e==="xml:space"&&r!=="default"&&r!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');t[e]=r}if(this.f.sortAttributes){let e=Object.keys(t).sort(),r=Object.create(null);for(let n=0;n<e.length;++n){let s=e[n];r[s]=t[s]}t=r}return t}J(){let{c:t}=this,e=t.h();if(e!=='"'&&e!=="'")return!1;t.g();let r,n=!1,s=B,i=e==='"'?St:bt;t:for(;!t.z;)switch(r=t.G(i),r&&(this.p(r),s+=r.replace(yt," ")),t.h()){case e:n=!0;break t;case"&":s+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");case B:break t}if(!n)throw this.a("Unclosed attribute");return t.g(),s}K(){let{c:t}=this,e=t.d;if(!t.b("<![CDATA["))return!1;let r=t.t("]]>");if(this.p(r),!t.b("]]>"))throw this.a("Unclosed CDATA section");return this.f.preserveCdata?this.j(new q(G(r)),e):this.x(r,e)}L(){let{c:t}=this,e=t.d,r=t.A(wt);if(!r)return!1;if(this.p(r),t.h(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.x(r,e)}D(){let{c:t}=this,e=t.d;if(!t.b("<!--"))return!1;let r=t.t("--");if(this.p(r),!t.b("-->"))throw t.h(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.f.preserveComments?this.j(new V(G(r)),e):!0}M(){let t=this.c.d,e=this.C();return e?this.x(e,t):!1}N(){let{c:t}=this,e=t.d;if(!t.b("<!DOCTYPE"))return!1;let r=this.e()&&this.r();if(!r)throw this.a("Expected a name");let n,s;if(this.e()){if(t.b("PUBLIC")){if(n=this.e()&&this.O(),n===!1)throw this.a("Expected a public identifier");this.e()}if(n!==void 0||t.b("SYSTEM")){if(this.e(),s=this.s(),s===!1)throw this.a("Expected a system identifier");this.e()}}let i;if(t.b("[")){if(i=t.A(/\][\x20\t\r\n]*>/),!t.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!t.b(">"))throw this.a("Unclosed doctype declaration");return this.f.preserveDocumentType?this.j(new H(r,n,s,i),e):!0}B(){let{c:t}=this,e=t.d;if(!t.b("<"))return!1;let r=this.r();if(!r)return t.o(e),!1;let n=this.I(),s=!!t.b("/>"),i=new O(r,n);if(i.parent=this.l,!s){if(!t.b(">"))throw this.a(`Unclosed start tag for element \`${r}\``);this.l=i;do this.L();while(this.B()||this.M()||this.K()||this.E()||this.D());let o=t.d,l;if(!t.b("</")||!(l=this.r())||l!==r)throw t.o(o),this.a(`Missing end tag for element ${r}`);if(this.e(),!t.b(">"))throw this.a(`Unclosed end tag for element ${r}`);this.l=i.parent}return this.j(i,e)}u(){return this.e(),this.c.b("=")?(this.e(),!0):!1}w(){return this.D()||this.E()||this.e()}r(){return Y(this.c.h())?this.c.v($):B}E(){let{c:t}=this,e=t.d;if(!t.b("<?"))return!1;let r=this.r();if(r){if(r.toLowerCase()==="xml")throw t.o(e),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(t.b("?>"))return this.j(new X(r),e);throw this.a("Whitespace is required after a processing instruction name")}let n=t.t("?>");if(this.p(n),!t.b("?>"))throw this.a("Unterminated processing instruction");return this.j(new X(r,G(n)),e)}H(){let{c:t}=this,e=t.d;for(this.P();this.w(););if(this.N())for(;this.w(););return e<t.d}O(){let t=this.c.d,e=this.s();if(e!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(e))throw this.c.o(t),this.a("Invalid character in public identifier");return e}C(){let{c:t}=this;if(!t.b("&"))return!1;let e=t.v(xt);if(t.F()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let r;if(e[0]==="#"){let n=e[1]==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);if(isNaN(n))throw this.a("Invalid character reference");if(!W(n))throw this.a("Character reference resolves to an invalid character");r=String.fromCodePoint(n)}else if(r=vt[e],r===void 0){let{ignoreUndefinedEntities:n,resolveUndefinedEntity:s}=this.f,i=`&${e};`;if(s){let o=s(i);if(o!=null){let l=typeof o;if(l!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${l}`);return o}}if(n)return i;throw t.o(-i.length),this.a(`Named entity isn't defined: ${i}`)}return r}s(){let{c:t}=this,e=t.b('"')||t.b("'");if(!e)return!1;let r=t.t(e);if(this.p(r),!t.b(e))throw this.a("Missing end quote");return r}e(){return!!this.c.v(Ot)}P(){let{c:t}=this,e=t.d;if(!t.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let r=!!t.b("version")&&this.u()&&this.s();if(r===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(r))throw this.a("Invalid character in version number");let n,s;if(this.e()&&(n=!!t.b("encoding")&&this.u()&&this.s(),n&&this.e(),s=!!t.b("standalone")&&this.u()&&this.s(),s)){if(s!=="yes"&&s!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}if(!t.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.f.preserveXmlDeclaration?this.j(new K(r,n||void 0,s||void 0),e):!0}a(t){let{c:e}=this;return new Q(t,e.d,e.m)}p(t){let{length:e}=t;for(let r=0;r<e;++r){let n=t.codePointAt(r);if(!W(n))throw this.c.o(-([...t].length-r)),this.a("Invalid character");n>65535&&(r+=1)}}};function G(t){let e=0;for(;(e=t.indexOf("\r",e))!==-1;)t=t[e+1]===`
`?t.slice(0,e)+t.slice(e+1):t.slice(0,e)+`
`+t.slice(e+1);return t}function Tt(t,e){return new Gt(t,e).document}class Nt extends Error{constructor(e){super(e)}}function Ct(t){let e=null;try{e=D.parseXml(t)}catch(r){throw new Nt(r.message)}return e}function T(t){const e=t.indexOf(":");return e>-1?t.substr(e+1):t}function S(t){return t.children[0]}function N(t){return t.name||""}function m(t,e,r=!1){const n=T(e);function s(i,o){return T(N(o))===n&&i.push(o),r&&Array.isArray(o.children)?[...i,...o.children.reduce(s,[])]:i}return t&&Array.isArray(t.children)?t.children.reduce(s,[]):[]}function a(t,e,r=!1){return m(t,e,r)[0]||null}function w(t){return t&&Array.isArray(t.children)?[...t.children.filter(e=>e instanceof D.XmlElement)]:[]}function c(t){const e=t&&Array.isArray(t.children)?t.children.find(r=>r.type==="text"):null;return e?e.text:""}function E(t,e){return t&&t.attributes[e]||""}class M extends Error{constructor(e,r,n){super(e),this.message=e,this.httpStatus=r,this.isCrossOriginRelated=n}}const Z=["utf-8","utf-16","iso-8859-1"],tt="utf-8";function Lt(t){const e=/charset=([^;]+)/.exec(t);return e?e[1]:null}function Ft(t,e){const r=e?Lt(e):null,n=r?[r,...Z]:Z;for(const s of n)try{return new TextDecoder(s,{fatal:!0}).decode(t)}catch{}return console.warn(`[ogc-client] XML document encoding could not be determined, falling back to ${tt}.`),new TextDecoder(tt).decode(t)}const C=new Map;let et={};function It(t){et=t}function rt(){return et}function At(t,e="GET"){const r=`${e}#${t}`;if(C.has(r))return C.get(r);const n=fetch(t,{...rt(),method:e}).catch(s=>s).then(s=>(C.delete(r),s));return C.set(r,n),n.then(s=>{if(s instanceof Error)throw s;return s})}function R(t){return At(t).catch(()=>fetch(t,{...rt(),method:"HEAD",mode:"no-cors"}).catch(e=>{throw new M(`Fetching the document failed either due to network errors or unreachable host, error is: ${e.message}`,0,!1)}).then(()=>{throw new M("The document could not be fetched due to CORS limitations",0,!0)})).then(async e=>{if(!e.ok){const s=await e.text();throw new M(`Received an error with code ${e.status}: ${s}`,e.status,!1)}const r=await e.arrayBuffer(),n=e.headers.get("Content-Type");return Ft(r,n)}).then(e=>Ct(e))}function nt(t,e){const r=t.match(/(https?%3A%2F%2F[^/]+)$/);if(r){const l=r[1],f=nt(decodeURIComponent(l),e);return t.replace(l,encodeURIComponent(f))}const n=new URL(t),s=Object.keys(e),i=s.map(l=>l.toLowerCase()),o=[];for(const l of n.searchParams.keys())i.indexOf(l.toLowerCase())>-1&&o.push(l);return o.map(l=>n.searchParams.delete(l)),s.forEach(l=>n.searchParams.set(l,e[l]===!0?"":e[l])),n.toString()}const _t=["EPSG:4046","EPSG:4075","EPSG:4120","EPSG:4122","EPSG:4124","EPSG:4126","EPSG:4149","EPSG:4151","EPSG:4153","EPSG:4155","EPSG:4157","EPSG:4159","EPSG:4161","EPSG:4163","EPSG:4165","EPSG:4167","EPSG:4169","EPSG:4171","EPSG:4173","EPSG:4175","EPSG:4178","EPSG:4180","EPSG:4182","EPSG:4184","EPSG:4188","EPSG:4190","EPSG:4191","EPSG:4196","EPSG:4198","EPSG:4202","EPSG:4210","EPSG:4211","EPSG:4214","EPSG:4226","EPSG:4229","EPSG:4231","EPSG:4233","EPSG:4236","EPSG:4238","EPSG:4240","EPSG:4242","EPSG:4244","EPSG:4246","EPSG:4248","EPSG:4250","EPSG:4252","EPSG:4255","EPSG:4258","EPSG:4261","EPSG:4264","EPSG:4267","EPSG:4270","EPSG:4273","EPSG:4276","EPSG:4279","EPSG:4281","EPSG:4284","EPSG:4286","EPSG:4288","EPSG:4292","EPSG:4295","EPSG:4297","EPSG:4299","EPSG:4302","EPSG:4324","EPSG:4326"];function Xt(t){return _t.indexOf(U(t))>-1}function U(t){return/^urn:(?:x-)?ogc:def:crs:epsg:/.test(t.toLowerCase())?`EPSG:${/([0-9]+)$/.exec(t)[1]}`:t}function st(t){return S(t).attributes.version}function Bt(t){const e=st(t),r=a(S(t),"Capability");return m(r,"Layer").map(n=>it(n,e))}function Mt(t){const e=a(S(t),"Service"),r=m(a(e,"KeywordList"),"Keyword").map(c).filter((n,s,i)=>i.indexOf(n)===s);return{title:c(a(e,"Title")),name:c(a(e,"Name")),abstract:c(a(e,"Abstract")),fees:c(a(e,"Fees")),constraints:c(a(e,"AccessConstraints")),keywords:r}}function it(t,e,r=[],n=[],s=null,i=null){const o=e==="1.3.0"?"CRS":"SRS",l=m(t,o).map(c),f=l.length>0?l:r,u=m(t,"Style").map(Rt),d=u.length>0?u:n;function g(P){const b=E(P,o);return(Xt(b)&&e==="1.3.0"?["miny","minx","maxy","maxx"]:["minx","miny","maxx","maxy"]).map(Jt=>E(P,Jt))}function p(P){return["westBoundLongitude","southBoundLatitude","eastBoundLongitude","northBoundLatitude"].map(b=>c(a(P,b)))}function F(P){return["minx","miny","maxx","maxy"].map(b=>E(P,b))}const ot=a(t,"Attribution"),lt=ot!==null?Ut(ot):s,j=e==="1.3.0"?a(t,"EX_GeographicBoundingBox"):a(t,"LatLonBoundingBox"),ht={};j&&(ht["EPSG:4326"]=e==="1.3.0"?p(j):F(j));let v=m(t,"BoundingBox").reduce((P,b)=>({...P,[E(b,o)]:g(b)}),ht);v=Object.keys(v).length>0||i===null?v:i;const ct=m(t,"Layer").map(P=>it(P,e,f,d,lt,v));return{name:c(a(t,"Name")),title:c(a(t,"Title")),abstract:c(a(t,"Abstract")),availableCrs:f,styles:d,attribution:lt,boundingBoxes:v,...ct.length&&{children:ct}}}function Rt(t){const e=E(a(a(t,"LegendURL"),"OnlineResource"),"xlink:href");return{name:c(a(t,"Name")),title:c(a(t,"Title")),...e&&{legendUrl:e}}}function Ut(t){const e=E(a(a(t,"LogoURL"),"OnlineResource"),"xlink:href"),r=E(a(t,"OnlineResource"),"xlink:href"),n=c(a(t,"Title"));return{...n&&{title:n},...r&&{url:r},...e&&{logoUrl:e}}}function L(t){return S(t).attributes.version}function at(t){const e=L(t);let r;if(e.startsWith("1.0")){const n=a(a(a(S(t),"Capability"),"Request"),"GetFeature");r=w(a(n,"ResultFormat")).map(N)}else{const n=a(S(t),"OperationsMetadata"),s=m(n,"Operation").find(o=>E(o,"name")==="GetFeature"),i=m(s,"Parameter").find(o=>E(o,"name")==="outputFormat");r=m(i,"Value",!0).map(c)}return r}function jt(t){const e=L(t),r=e.startsWith("1.0")?"Service":"ServiceIdentification",n=e.startsWith("1.0")?"Name":"ServiceType",s=a(S(t),r);let i;return e.startsWith("1.0")?i=c(a(s,"Keywords")).split(",").map(o=>o.trim()):i=m(a(s,"Keywords"),"Keyword").map(c),{title:c(a(s,"Title")),name:c(a(s,n)),abstract:c(a(s,"Abstract")),fees:c(a(s,"Fees")),constraints:c(a(s,"AccessConstraints")),keywords:i,outputFormats:at(t)}}function kt(t){const e=L(t),r=at(t),n=a(S(t),"FeatureTypeList");return m(n,"FeatureType").map(s=>Dt(s,e,r))}function Dt(t,e,r){const n=e.startsWith("2.")?"CRS":"SRS",s=e.startsWith("1.0")?"SRS":`Default${n}`;function i(){const u=a(t,"LatLongBoundingBox");return["minx","miny","maxx","maxy"].map(d=>E(u,d)).map(parseFloat)}function o(){const u=a(t,"WGS84BoundingBox");return["LowerCorner","UpperCorner"].map(d=>a(u,d)).map(d=>c(d).split(" ")).reduce((d,g)=>[...d,...g]).map(parseFloat)}const l=e.startsWith("1.0")?[]:m(t,`Other${n}`).map(c).map(U),f=e.startsWith("1.0")?[]:m(a(t,"OutputFormats"),"Format").map(c);return{name:c(a(t,"Name")),title:c(a(t,"Title")),abstract:c(a(t,"Abstract")),defaultCrs:U(c(a(t,s))),otherCrs:l,outputFormats:f.length>0?f:r,latLonBoundingBox:e.startsWith("1.0")?i():o()}}function $t(t,e,r){const n=S(t);let s;if(r.startsWith("2.0"))s=m(n,"member").map(u=>w(u)[0]);else{const u=a(n,"featureMembers");s=u?w(u):m(n,"featureMember").map(d=>w(d)[0])}const i=r==="1.0.0"?"fid":"gml:id";function o(u){return u in e.properties}function l(u,d){switch(e.properties[u]){case"integer":return parseInt(d);case"float":return parseFloat(d);case"boolean":return d==="true";default:return d}}function f(u){return w(u).filter(d=>o(T(N(d)))).reduce((d,g)=>{const p=T(N(g));return{...d,[p]:l(p,c(g))}},{})}return s.map(u=>({id:E(u,i),properties:f(u)}))}function Yt(t){return t.reduce((e,r)=>{for(const n in r.properties){const s=r.properties[n];n in e||(e[n]={uniqueValues:[]});const i=e[n].uniqueValues.find(o=>o.value===s);i?i.count++:e[n].uniqueValues.push({value:s,count:1})}return e},{})}function Wt(t,e,r,n,s,i,o,l,f,u){const d=e==="2.0.0"?"TYPENAMES":"TYPENAME",g=e==="2.0.0"?"COUNT":"MAXFEATURES",p={SERVICE:"WFS",REQUEST:"GetFeature",VERSION:e,[d]:r};if(n!==void 0&&(p.OUTPUTFORMAT=n),i!==void 0&&(p.PROPERTYNAME=i.join(",")),o?(p.RESULTTYPE="hits",p[g]="1"):s!==void 0&&(p[g]=s.toString(10)),l&&(p.SRSNAME=l),f){const F=f.join(",");p.BBOX=u?`${F},${u}`:F}return nt(t,p)}x("parseWmsCapabilities",globalThis,({url:t})=>R(t).then(e=>({info:Mt(e),layers:Bt(e),version:st(e)}))),x("parseWfsCapabilities",globalThis,({url:t})=>R(t).then(e=>({info:jt(e),featureTypes:kt(e),version:L(e)}))),x("queryWfsFeatureTypeDetails",globalThis,({url:t,serviceVersion:e,featureTypeFull:r})=>{const n=Wt(t,e,r.name,void 0,void 0,Object.keys(r.properties));return R(n).then(s=>({props:Yt($t(s,r,e))}))}),x("updateFetchOptions",globalThis,({options:t})=>(It(t),Promise.resolve({})))})();
